{"title":"Entity Framework常用操作","uid":"0adec41aad666bb9dbc2e935ddaf42e9","slug":"Entity Framework常用操作","date":"2025-07-29T09:26:07.000Z","updated":"2025-07-29T09:59:35.878Z","comments":true,"path":"api/articles/Entity Framework常用操作.json","keywords":null,"cover":null,"content":"<h1 id=\"一、基础操作（增删改查）\"><a href=\"#一、基础操作（增删改查）\" class=\"headerlink\" title=\"一、基础操作（增删改查）\"></a>一、基础操作（增删改查）</h1><p>▶ <strong>添加数据（Create）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DB context = <span class=\"keyword\">new</span> DB()</span><br><span class=\"line\">User user = <span class=\"keyword\">new</span> User &#123;Name = <span class=\"string\">&quot;Felix Still&quot;</span>,Age = <span class=\"number\">20</span>&#125;;</span><br><span class=\"line\">context.Users.Add(user);</span><br><span class=\"line\">context.SaveChanges();</span><br></pre></td></tr></table></figure>\n\n<p>▶ <strong>查询数据（Read）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Query all data.</span></span><br><span class=\"line\">User user = context.Users.ToList&lt;User&gt;(); || <span class=\"keyword\">var</span> user = context.Users.ToList();</span><br><span class=\"line\"><span class=\"comment\">// Conditional query.</span></span><br><span class=\"line\">User user = context.Users.FirstOrDefault&lt;User&gt;(u =&gt; u.id == <span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"comment\">// Fuzzy matching</span></span><br><span class=\"line\">List&lt;User&gt; userList = context.Users.Where(u =&gt; u.Name.Contains(<span class=\"string\">&quot;Felix&quot;</span>));</span><br></pre></td></tr></table></figure>\n\n<p>▶ <strong>修改数据（Update）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User user = context.Users.FirstOrDefault&lt;User&gt;(u =&gt; u.id == <span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(user == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">\tMessageBox.Show(<span class=\"string\">$&quot;error info:<span class=\"subst\">&#123;user.id&#125;</span>的用户不存在&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">user.Name = <span class=\"string\">&quot;Raymond&quot;</span>;</span><br><span class=\"line\">\tcontext.SaveChanges();</span><br></pre></td></tr></table></figure>\n\n<p>▶ <strong>删除数据（Delete）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User user = context.Users.FirstOrDefault&lt;User&gt;(u =&gt; u.id == <span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(user != <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">\tcontext.Users.<span class=\"keyword\">remove</span>(user);</span><br><span class=\"line\">\tcontext.SaveChanges();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"二、分页、排序、投影\"><a href=\"#二、分页、排序、投影\" class=\"headerlink\" title=\"二、分页、排序、投影\"></a>二、分页、排序、投影</h1><p>▶ <strong>分页查询（Skip + Take）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">int</span> pageSize = <span class=\"number\">10</span>, pageIndex = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> pageData= context.Users.OrderBy(u =&gt; u.id)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t.Skip((pageIndex - <span class=\"number\">1</span>)*pageSize)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t.Take(pageSize)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t.ToList();</span><br></pre></td></tr></table></figure>\n\n<p>▶ <strong>投影（Select）</strong></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> result = context.Users.Select(u =&gt; <span class=\"keyword\">new</span> &#123;user_id=u.id,username=u.name&#125;);</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"三、事务处理\"><a href=\"#三、事务处理\" class=\"headerlink\" title=\"三、事务处理\"></a>三、事务处理</h1><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> transaction = context.Database.BeginTransaction())</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 业务逻辑</span></span><br><span class=\"line\">        context.SaveChanges();</span><br><span class=\"line\">        transaction.Commit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        transaction.Rollback();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","text":"一、基础操作（增删改查）▶ 添加数据（Create） 1234DB context = new DB()User user = new User {Name =...","permalink":"/post/Entity Framework常用操作","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"Entity Framework","slug":"Entity-Framework","count":3,"path":"api/tags/Entity-Framework.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%EF%BC%88%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%EF%BC%89\"><span class=\"toc-text\">一、基础操作（增删改查）</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E5%88%86%E9%A1%B5%E3%80%81%E6%8E%92%E5%BA%8F%E3%80%81%E6%8A%95%E5%BD%B1\"><span class=\"toc-text\">二、分页、排序、投影</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86\"><span class=\"toc-text\">三、事务处理</span></a></li></ol>","author":{"name":"Felix Still","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"Documenting my journey in Android native and WinForms development. Tutorials, experiments, and practical coding experiences.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"DataGridView常用操作","uid":"cc26a2e6e1a0489e6526665c276705dd","slug":"DataGridView常用操作","date":"2025-07-29T09:26:07.000Z","updated":"2025-07-29T09:30:18.760Z","comments":true,"path":"api/articles/DataGridView常用操作.json","keywords":null,"cover":null,"text":"一、动态添加列 前置准备：清空旧列（可选） 1datagridview1.Columns.Clear(); 动态添加各种列 添加文本列（DataGridView...","permalink":"/post/DataGridView常用操作","photos":[],"count_time":{"symbolsCount":"5.1k","symbolsTime":"5 mins."},"categories":[],"tags":[{"name":"Winform","slug":"Winform","count":1,"path":"api/tags/Winform.json"}],"author":{"name":"Felix Still","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"Documenting my journey in Android native and WinForms development. Tutorials, experiments, and practical coding experiences.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"图片上传控件","uid":"4f746ee5321e2060cb95a81153a748fa","slug":"图片上传控件","date":"2025-07-29T09:26:07.000Z","updated":"2025-07-29T09:59:48.335Z","comments":true,"path":"api/articles/图片上传控件.json","keywords":null,"cover":null,"text":"✅ 一、使用控件组合实现图片上传功能💡 常用控件： PictureBox：用于展示图片 Button：点击上传 OpenFileDialog：选择图片文件 🔧 ...","permalink":"/post/图片上传控件","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"Entity Framework","slug":"Entity-Framework","count":3,"path":"api/tags/Entity-Framework.json"}],"author":{"name":"Felix Still","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"Documenting my journey in Android native and WinForms development. Tutorials, experiments, and practical coding experiences.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}